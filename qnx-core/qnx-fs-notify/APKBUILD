pkgname="qnx-fs-notify"
pkgver=8.0.3
_fs_notify_version=0.0.2.02005T202411230033L
pkgrel=2
pkgdesc="QNX File System (inotify) Support"
url="https://qnx.com"
arch="all"
license="LicenseRef-QDL-Non-Commercial"
options="!strip !tracedeps"
depends="qnx-secpol qnx-libslog2 qnx-libqh"
subpackages="$pkgname-dev"
source="fs_notify_$_fs_notify_version.qpkg::$QSC_URL/com.qnx.qnx800.target.fs.notify/$_fs_notify_version/download"

prepare() {
   for qpkg in *.qpkg; do
        tar xf $qpkg
   done
}

# extglob for trimming out other arch's toolchain
shopt -s extglob
package() {
    mkdir -p "$pkgdir"
    echo "Moving common headers"
    mv "$srcdir"/target/qnx/usr "$pkgdir"
    echo $CARCH
    _qarch=$CARCH
    if [[ $CARCH == "aarch64" ]]; then
        export _qarch=aarch64le
    fi
    mkdir -p "$pkgdir"/usr/{bin,lib}
    echo "Moving arch-specfic ($_qarch) binaries"
    cp -r "$srcdir"/target/qnx/$_qarch/sbin/* "$pkgdir"/usr/bin/
    echo "Moving arch-specific ($_qarch) libraries"
    cp -r "$srcdir"/target/qnx/$_qarch/lib/* "$pkgdir"/usr/lib/
}

dev() {
    default_dev

    amove usr/bin/*.sym
    amove usr/lib/*.sym
}

sha512sums="
1419663fd33639f8a91f3f02527a1a16ee42de5e4cbdbed87c9c620ca2f9d57a161a7b5491f9cac89d00bade9465de3adbe4184da4cb3f70b8159b853a2c8565  fs_notify_0.0.2.02005T202411230033L.qpkg
"
